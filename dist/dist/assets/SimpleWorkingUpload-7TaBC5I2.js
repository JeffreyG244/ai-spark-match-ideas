import{j as t}from"./vendor-ui-BOBT-NyQ.js";import{r as p}from"./vendor-LxWyOK1e.js";import{u as _,t as g,s as P,b as N,c as S,d as C,e as U,B as w,X as D}from"./index-DNN11rcK.js";import{C as E}from"./camera-Chtrexk9.js";import{S as k}from"./star-DzkWTCKw.js";import{U as z}from"./upload-wtuO50Cj.js";const A=()=>{const{user:l}=_(),[e,f]=p.useState({}),[x,n]=p.useState(!1),[v,m]=p.useState(!1),[o,y]=p.useState(!1);return{profileData:e,profileExists:x,isLoading:v,isSaving:o,loadProfile:async()=>{if(l){m(!0);try{const{data:a,error:i}=await P.from("user_profiles").select("*").eq("id",l.id).maybeSingle();i&&i.code;const s=a?.public_data||{},u=a?.private_data||{},h={first_name:s.first_name||"",last_name:s.last_name||"",age:s.age?.toString()||"",gender:s.gender||"",bio:s.bio||"",city:s.city||"",state:s.state||"",zipcode:s.zipcode||"",interests:Array.isArray(s.interests)?s.interests.join(", "):s.interests||"",photo_urls:a?.photo_urls||[]};f(h),n(!!a)}catch{g({title:"Load Error",description:"An unexpected error occurred while loading your profile.",variant:"destructive"})}finally{m(!1)}}},saveProfile:async(a=!0)=>{if(!l)return g({title:"Authentication Required",description:"Please log in to save your profile.",variant:"destructive"}),{success:!1};if(o)return{success:!1};y(!0);try{const i={first_name:e.first_name||"",last_name:e.last_name||"",age:e.age?parseInt(e.age):null,gender:e.gender||"",bio:e.bio||"",city:e.city||"",state:e.state||"",zipcode:e.zipcode||"",interests:e.interests?e.interests.split(",").map(h=>h.trim()):[]},s={id:l.id,public_data:i,private_data:{},photo_urls:e.photo_urls||[],updated_at:new Date().toISOString()},{error:u}=await P.from("user_profiles").upsert(s,{onConflict:"id",ignoreDuplicates:!1});return u?(g({title:"Save Failed",description:`Failed to save profile: ${u.message}`,variant:"destructive"}),{success:!1}):(n(!0),a&&g({title:"Profile Saved",description:"Your profile has been saved successfully!"}),{success:!0})}catch{return g({title:"Unexpected Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"}),{success:!1}}finally{y(!1)}},updateProfileField:(a,i)=>{f(s=>({...s,[a]:i}))},isBasicProfileComplete:()=>!!(e.bio&&e.bio.length>=150&&e.age&&e.gender&&e.sexual_orientation&&e.city&&e.state)}},L=()=>{const{user:l}=_(),{profileData:e,updateProfileField:f,saveProfile:x}=A(),n=p.useRef(null),[v,m]=p.useState(!1),o=e.photo_urls||[],y=async d=>{const r=d.target.files;if(!(!r||!r.length||!l)){m(!0);try{const c=r[0];if(!c.type.startsWith("image/")){alert("Please select an image file");return}if(c.size>5*1024*1024){alert("File too large. Please use a file under 5MB");return}const a=Date.now(),i=`${l.id}/${a}_${c.name}`,{data:s,error:u}=await P.storage.from("profile-photos").upload(i,c);if(u){alert("Upload failed: "+u.message);return}const{data:{publicUrl:h}}=P.storage.from("profile-photos").getPublicUrl(i),j=[...o,h];f("photo_urls",j),await x(!1),alert("Photo uploaded successfully!")}catch{alert("Upload failed")}finally{m(!1),n.current&&(n.current.value="")}}},b=async d=>{const r=o.filter((c,a)=>a!==d);f("photo_urls",r),await x(!1),alert("Photo removed")};return t.jsxs(N,{className:"bg-gradient-to-br from-purple-600/90 to-pink-600/80 backdrop-blur-sm border-purple-400/50",children:[t.jsx(S,{children:t.jsxs(C,{className:"text-white flex items-center gap-2",children:[t.jsx(E,{className:"w-5 h-5"}),"Professional Photo Gallery"]})}),t.jsxs(U,{className:"space-y-4",children:[o.length>0&&t.jsx("div",{className:"grid grid-cols-3 gap-3",children:o.map((d,r)=>t.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-white/10 group",children:[t.jsx("img",{src:d,alt:`Photo ${r+1}`,className:"w-full h-full object-cover"}),r===0&&t.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white text-xs px-2 py-1 rounded flex items-center gap-1",children:[t.jsx(k,{className:"w-3 h-3 fill-current"}),"Primary"]}),t.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:t.jsx(w,{size:"sm",variant:"destructive",onClick:()=>b(r),className:"p-1",children:t.jsx(D,{className:"w-3 h-3"})})})]},r))}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs(w,{onClick:()=>n.current?.click(),disabled:v,className:"w-full bg-white/20 hover:bg-white/30 text-white border-white/20",size:"lg",children:[t.jsx(z,{className:"w-4 h-4 mr-2"}),v?"Uploading...":"Upload Photos"]}),t.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:y,className:"hidden",multiple:!1})]}),t.jsx("div",{className:"text-center",children:t.jsxs("p",{className:"text-white/70 text-sm",children:[o.length," of 6 photos uploaded"]})})]})]})};export{L as S,A as u};
