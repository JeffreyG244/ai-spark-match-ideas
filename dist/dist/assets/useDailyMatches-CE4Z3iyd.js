import{r as S}from"./vendor-LxWyOK1e.js";import{u as A,s as y}from"./index-DNN11rcK.js";const k=()=>{const{user:l}=A(),[W,w]=S.useState([]),[v,h]=S.useState(!1),E=async()=>{if(!l){w([]),h(!1);return}h(!0);try{let o={gender_preference:"Everyone",age_min:18,age_max:65},r="Unknown";null?.answers;const{data:f,error:b}=await y.from("daily_matches").select("*").eq("user_id",l.id).eq("date",new Date().toISOString().split("T")[0]).order("recommendation_score",{ascending:!1});let m=[];if(!f||f.length===0){let{data:u,error:M}=await y.from("users").select("*").eq("is_active",!0).gte("age",o.age_min).lte("age",o.age_max).neq("id",l.id);if(M||!u){w([]);return}const D=u.map(n=>n.id).filter(Boolean);let p=[];const s=null,e=new Map;p?.forEach(n=>{e.set(n.user_id,n.answers)});const c=u.map(n=>({...n,compatibility_answers:e.get(n.id)||null}));if(c&&c.length>0&&(m=c.filter(n=>{if(!n||!n.compatibility_answers)return!1;const a=n.compatibility_answers;if(!a)return!1;const t=n.gender?.toLowerCase(),d=a[12];let g=!1;(o.gender_preference==="Everyone"||o.gender_preference==="Men"&&(t==="male"||t==="man"||t==="men")||o.gender_preference==="Women"&&(t==="female"||t==="woman"||t==="women")||o.gender_preference==="Non-binary"&&(t==="non-binary"||t==="nonbinary"))&&(g=!0);let _=!1;return(d==="Everyone"||d==="Men"&&(r==="Male"||r==="Man"||r==="male"||r==="man")||d==="Women"&&(r==="Female"||r==="Woman"||r==="female"||r==="woman")||d==="Non-binary"&&(r==="Non-binary"||r==="Nonbinary"||r==="non-binary"||r==="nonbinary"))&&(_=!0),g&&_})),m&&m.length>0){const n=m.slice(0,5).map(a=>({id:`daily-${l.id}-${a.id}`,user_id:l.id,suggested_user_id:a.id,compatibility_score:Math.floor(Math.random()*30)+60,suggested_date:new Date().toISOString().split("T")[0],viewed:!1,created_at:new Date().toISOString(),user_profile:{id:a.id,email:a.email,bio:a.bio,photos:Array.isArray(a.photos)&&a.photos.length>0?a.photos:["https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop"],first_name:a.first_name,age:a.age,gender:a.gender}}));w(n);return}}if(f&&f.length>0){const u=f.map(s=>s.recommended_user_id),{data:M,error:D}=await y.from("users").select("*").in("id",u);if(D)return;const p=f.map(s=>{const e=M?.find(c=>c.id===s.recommended_user_id);return{id:s.id,user_id:s.user_id,suggested_user_id:s.recommended_user_id,compatibility_score:s.recommendation_score||75,suggested_date:s.date,viewed:!1,created_at:new Date().toISOString(),user_profile:e?{id:e.id,email:e.email||`${e.id}@example.com`,bio:e.bio||"",photos:e.photos&&Array.isArray(e.photos)&&e.photos.length>0?e.photos:["https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop"],first_name:e.first_name||"User",age:e.age||25,gender:e.gender||"Unknown"}:{id:s.recommended_user_id,email:`${s.recommended_user_id}@example.com`,bio:"",photos:["https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop"],first_name:"User",age:25,gender:"Unknown"}}});w(p)}else w([])}catch{}finally{h(!1)}},U=async(o=5)=>{if(l){h(!0);try{let r={gender_preference:"Everyone",age_min:18,age_max:65},i="Unknown";null?.answers;let{data:b,error:m}=await y.from("users").select("*").eq("is_active",!0).gte("age",r.age_min).lte("age",r.age_max).neq("id",l.id).limit(o*2);if(m||!b)return;const u=b.map(e=>e.id).filter(Boolean);let M=[];const D=null,p=new Map;M?.forEach(e=>{p.set(e.user_id,e.answers)});const s=b.map(e=>({...e,compatibility_answers:p.get(e.id)||null}));if(s&&s.length>0){const c=s.filter(n=>{if(!n||!n.compatibility_answers)return!1;const a=n.compatibility_answers;if(!a)return!1;const t=n.gender?.toLowerCase(),d=a[12];return(r.gender_preference==="Everyone"||r.gender_preference==="Men"&&(t==="male"||t==="man"||t==="men")||r.gender_preference==="Women"&&(t==="female"||t==="woman"||t==="women")||r.gender_preference==="Non-binary"&&(t==="non-binary"||t==="nonbinary"))&&(d==="Everyone"||d==="Men"&&(i==="Male"||i==="Man"||i==="male"||i==="man")||d==="Women"&&(i==="Female"||i==="Woman"||i==="female"||i==="woman")||d==="Non-binary"&&(i==="Non-binary"||i==="Nonbinary"||i==="non-binary"||i==="nonbinary")||i==="Unknown")}).slice(0,o).map(n=>({user_id:l.id,recommended_user_id:n.id,recommendation_score:Math.floor(Math.random()*30)+60,date:new Date().toISOString().split("T")[0]}));if(c.length>0){const{error:n}=await y.from("daily_matches").insert(c)}}await E()}catch{}finally{h(!1)}}},x=async o=>{try{const{error:r}=await y.from("daily_matches").update({action:"viewed"}).eq("id",o)}catch{}};return S.useEffect(()=>{l&&E()},[l]),{dailyMatches:W,isLoading:v,loadDailyMatches:E,generateDailyMatches:U,markAsViewed:x}};export{k as u};
