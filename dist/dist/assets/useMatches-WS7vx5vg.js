import{r as p}from"./vendor-LxWyOK1e.js";import{u as U,t as g,s as m}from"./index-DNN11rcK.js";const C=()=>{const{user:s}=U(),[a,c]=p.useState({bio:"",values:"",lifeGoals:"",greenFlags:""}),[w,d]=p.useState(!1),[h,S]=p.useState(!1),[r,l]=p.useState(!1);return{profileData:a,profileExists:w,isLoading:h,isSaving:r,loadProfile:async()=>{if(s){S(!0);try{const{data:n,error:i}=await m.from("users").select("bio, family_goals, lifestyle_preference").eq("id",s.id).maybeSingle();if(i&&i.code!=="PGRST116")return;n?(d(!0),c({bio:n.bio||"",values:"",lifeGoals:n.family_goals||"",greenFlags:n.lifestyle_preference||""})):d(!1)}catch{}finally{S(!1)}}},saveProfile:async(n=!0)=>{if(!s)return g({title:"Authentication Required",description:"Please log in to save your profile.",variant:"destructive"}),{success:!1};if(r)return{success:!1};l(!0);try{const{error:i}=await m.from("users").update({bio:a.bio,family_goals:a.lifeGoals,lifestyle_preference:a.greenFlags,updated_at:new Date().toISOString()}).eq("id",s.id);if(i){if(i.message?.includes("no rows")||i.code==="PGRST116"||!w){const{error:t}=await m.from("users").insert({id:s.id,email:s.email,first_name:s.user_metadata?.first_name||"",last_name:s.user_metadata?.last_name||"",bio:a.bio,family_goals:a.lifeGoals,lifestyle_preference:a.greenFlags,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),city:"",date_of_birth:new Date(Date.now()-7884e8).toISOString().split("T")[0],age:25});return t?(g({title:"Profile Creation Failed",description:"Could not create your profile. Please contact support.",variant:"destructive"}),{success:!1}):(d(!0),n&&g({title:"Profile Saved",description:"Your profile has been created and saved successfully!"}),{success:!0})}const y=i.message?.includes("permission denied")?"Authentication issue. Please log out and log back in.":i.message?.includes("duplicate key")?"Profile already exists. Try refreshing the page.":"Failed to save profile. Please try again.";return g({title:"Save Failed",description:y,variant:"destructive"}),{success:!1}}return d(!0),n&&g({title:"Profile Saved",description:"Your profile has been saved successfully!"}),{success:!0}}catch{return g({title:"Unexpected Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"}),{success:!1}}finally{l(!1)}},updateProfileField:(n,i)=>{c(y=>({...y,[n]:i}))},isBasicProfileComplete:()=>a.bio.length>=50&&a.values.length>=50&&a.lifeGoals.length>=50&&a.greenFlags.length>=50}},L=()=>{const{user:s}=U(),[a,c]=p.useState([]),[w,d]=p.useState(!1),h=async()=>{if(!s){c([]),d(!1);return}d(!0);try{let r="Unknown",l={gender_preference:"Everyone"};null?.answers;const{data:f,error:E}=await m.from("executive_matches").select("*").or(`user_id.eq.${s.id},matched_user_id.eq.${s.id}`).eq("status","matched").order("created_at",{ascending:!1});if(E)return;if(!f||f.length===0){let{data:t,error:M}=await m.from("users").select("*").eq("is_active",!0).neq("id",s.id);if(M||!t){c([]);return}const o=t.map(e=>e.id).filter(Boolean);let D=[];const G=null,A=new Map;D?.forEach(e=>{A.set(e.user_id,e.answers)});const I=t.map(e=>({...e,compatibility_answers:A.get(e.id)||null})).filter(e=>{const F=e.compatibility_answers;if(!F)return!1;const u=e.gender?.toLowerCase(),v=F[12];let b=!1;(l.gender_preference==="Everyone"||l.gender_preference==="Men"&&(u==="male"||u==="man"||u==="men")||l.gender_preference==="Women"&&(u==="female"||u==="woman"||u==="women")||l.gender_preference==="Non-binary"&&(u==="non-binary"||u==="nonbinary"))&&(b=!0);let _=!1;return(v==="Everyone"||v==="Men"&&(r==="Male"||r==="Man"||r==="male"||r==="man")||v==="Women"&&(r==="Female"||r==="Woman"||r==="female"||r==="woman")||v==="Non-binary"&&(r==="Non-binary"||r==="Nonbinary"||r==="non-binary"||r==="nonbinary")||r==="Unknown")&&(_=!0),b&&_}).slice(0,10).map(e=>({id:`sample-${e.id}`,user_id:s.id,matched_user_id:e.id,compatibility:Math.floor(Math.random()*30)+70,created_at:new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString(),status:"accepted",match_profile:{id:e.id,email:e.email||`${e.id}@example.com`,bio:e.bio||"",photos:e.photos&&Array.isArray(e.photos)?e.photos:["https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop"],first_name:e.first_name||"User",age:e.age||25,gender:e.gender||"Unknown"}}));c(I);return}const x=f.map(t=>t.user_id===s.id?t.matched_user_id:t.user_id),{data:n,error:i}=await m.from("users").select("*").in("id",x);if(i)return;const y=f.map(t=>{const M=t.user_id===s.id?t.matched_user_id:t.user_id,o=n?.find(D=>D.id===M);return{id:t.id||`${t.user_id}-${t.matched_user_id}`,user_id:t.user_id,matched_user_id:t.matched_user_id,compatibility:t.compatibility_score||75,created_at:t.created_at||new Date().toISOString(),status:t.status||"accepted",match_profile:o?{id:o.id,email:o.email||`${o.id}@example.com`,bio:o.bio||"",photos:o.photos&&Array.isArray(o.photos)?o.photos:["https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop"],first_name:o.first_name||"User",age:o.age||25,gender:o.gender||"Unknown"}:void 0}});c(y)}catch{}finally{d(!1)}};return p.useEffect(()=>{h()},[s]),{matches:a,isLoading:w,loadMatches:h,deleteMatch:async r=>{if(!s)return!1;try{const{error:l}=await m.from("executive_matches").delete().eq("id",r);return r.startsWith("sample-")?(c(P=>P.filter(f=>f.id!==r)),!0):l?!1:(await h(),!0)}catch{return!1}}}};export{L as a,C as u};
